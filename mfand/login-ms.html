<!DOCTYPE html>
<html>

<style>
h1 {text-align: center; color: blue}
body {background: linear-gradient(90deg, rgba(0,255,0,0.9),rgba(0,128,0,0.9),rgba(0,255,0,0.9));
</style>

<body>

<h1>Pay No Attention to the Man Behind the Curtain</h1>

<script>
function haveToken() {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
      if (xhttp.readyState == 4 && xhttp.status == 200) {
      document.getElementById("postResp").innerHTML =
        "Logged in and authentication token saved.";
        window.location.replace('$v:final$');
    }
  };
  xhttp.open("POST", "sapiKeyData", true);
  xhttp.send("DONE");
}

function askLogin() {
    loginStr = "$v:redir$";
    window.addEventListener("message", function(e) {
        console.log(e.data);
        if (e.data == 'kazar1')
            haveToken();
    });

    newWin = window.open(loginStr);
}

window.onload = askLogin
</script>

<center>
  <h2>This page should only be visible for a short period while the login process is executing</h2>
  <p>
  If it sticks around, try the login button below; you may have a popup blocker running.
  <p>
  <button type="button" onclick="askLogin()" style="color:blue">Login to MS</button>
<p>
<a href="/">Home</a>
</center>

<div id="postResp">[Not logged in yet]</div>

</body>
</html>
